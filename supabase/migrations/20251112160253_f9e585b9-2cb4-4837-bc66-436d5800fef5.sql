-- Drop the incorrectly created table
DROP TABLE IF EXISTS public.agency_performance_metrics CASCADE;

-- Update transportation_providers table with ALL CSV columns
ALTER TABLE public.transportation_providers
  ADD COLUMN IF NOT EXISTS agency_id UUID REFERENCES public.transit_agencies(id) ON DELETE CASCADE,
  ADD COLUMN IF NOT EXISTS agency TEXT,
  ADD COLUMN IF NOT EXISTS city TEXT,
  ADD COLUMN IF NOT EXISTS state TEXT,
  ADD COLUMN IF NOT EXISTS ntd_id TEXT,
  ADD COLUMN IF NOT EXISTS organization_type TEXT,
  ADD COLUMN IF NOT EXISTS reporter_type TEXT,
  ADD COLUMN IF NOT EXISTS report_year INTEGER,
  ADD COLUMN IF NOT EXISTS uace_code TEXT,
  ADD COLUMN IF NOT EXISTS uza_name TEXT,
  ADD COLUMN IF NOT EXISTS primary_uza_population INTEGER,
  ADD COLUMN IF NOT EXISTS agency_voms INTEGER,
  ADD COLUMN IF NOT EXISTS mode TEXT,
  ADD COLUMN IF NOT EXISTS mode_name TEXT,
  ADD COLUMN IF NOT EXISTS type_of_service TEXT,
  ADD COLUMN IF NOT EXISTS mode_voms INTEGER,
  ADD COLUMN IF NOT EXISTS fare_revenues_per_unlinked NUMERIC,
  ADD COLUMN IF NOT EXISTS fare_revenues_per_unlinked_1 NUMERIC,
  ADD COLUMN IF NOT EXISTS fare_revenues_per_total NUMERIC,
  ADD COLUMN IF NOT EXISTS fare_revenues_per_total_1 NUMERIC,
  ADD COLUMN IF NOT EXISTS cost_per_hour NUMERIC,
  ADD COLUMN IF NOT EXISTS cost_per_hour_questionable TEXT,
  ADD COLUMN IF NOT EXISTS passengers_per_hour NUMERIC,
  ADD COLUMN IF NOT EXISTS passengers_per_hour_1 NUMERIC,
  ADD COLUMN IF NOT EXISTS cost_per_passenger NUMERIC,
  ADD COLUMN IF NOT EXISTS cost_per_passenger_1 NUMERIC,
  ADD COLUMN IF NOT EXISTS cost_per_passenger_mile NUMERIC,
  ADD COLUMN IF NOT EXISTS cost_per_passenger_mile_1 NUMERIC,
  ADD COLUMN IF NOT EXISTS fare_revenues_earned NUMERIC,
  ADD COLUMN IF NOT EXISTS fare_revenues_earned_1 NUMERIC,
  ADD COLUMN IF NOT EXISTS total_operating_expenses NUMERIC,
  ADD COLUMN IF NOT EXISTS total_operating_expenses_1 NUMERIC,
  ADD COLUMN IF NOT EXISTS unlinked_passenger_trips INTEGER,
  ADD COLUMN IF NOT EXISTS unlinked_passenger_trips_1 INTEGER,
  ADD COLUMN IF NOT EXISTS vehicle_revenue_hours NUMERIC,
  ADD COLUMN IF NOT EXISTS vehicle_revenue_hours_1 NUMERIC,
  ADD COLUMN IF NOT EXISTS passenger_miles NUMERIC,
  ADD COLUMN IF NOT EXISTS passenger_miles_questionable TEXT,
  ADD COLUMN IF NOT EXISTS vehicle_revenue_miles NUMERIC,
  ADD COLUMN IF NOT EXISTS vehicle_revenue_miles_1 NUMERIC,
  ADD COLUMN IF NOT EXISTS ntd_id_contract TEXT,
  ADD COLUMN IF NOT EXISTS agency_name TEXT,
  ADD COLUMN IF NOT EXISTS reporter_type_contract TEXT,
  ADD COLUMN IF NOT EXISTS reporting_module TEXT,
  ADD COLUMN IF NOT EXISTS mode_contract TEXT,
  ADD COLUMN IF NOT EXISTS tos TEXT,
  ADD COLUMN IF NOT EXISTS contractee_ntd_id TEXT,
  ADD COLUMN IF NOT EXISTS contractee_operator_name TEXT,
  ADD COLUMN IF NOT EXISTS reporter_contractual_position TEXT,
  ADD COLUMN IF NOT EXISTS type_of_contract TEXT,
  ADD COLUMN IF NOT EXISTS primary_feature TEXT,
  ADD COLUMN IF NOT EXISTS buyer_supplies_vehicles_to_seller TEXT,
  ADD COLUMN IF NOT EXISTS buyer_provides_maintenance_facility_to_seller TEXT,
  ADD COLUMN IF NOT EXISTS other_public_assets_provided TEXT,
  ADD COLUMN IF NOT EXISTS other_public_assets_provided_desc TEXT,
  ADD COLUMN IF NOT EXISTS service_captured TEXT,
  ADD COLUMN IF NOT EXISTS other_party TEXT,
  ADD COLUMN IF NOT EXISTS fares_retained_by TEXT,
  ADD COLUMN IF NOT EXISTS voms_under_contract INTEGER,
  ADD COLUMN IF NOT EXISTS months_seller_operated_in_fy INTEGER,
  ADD COLUMN IF NOT EXISTS pt_fare_revenues_passenger_fees NUMERIC,
  ADD COLUMN IF NOT EXISTS passenger_out_of_pocket_expenses NUMERIC,
  ADD COLUMN IF NOT EXISTS direct_payment_agency_subsidy NUMERIC,
  ADD COLUMN IF NOT EXISTS contract_capital_leasing_expenses NUMERIC,
  ADD COLUMN IF NOT EXISTS other_operating_expenses_incurred_by_the_buyer NUMERIC,
  ADD COLUMN IF NOT EXISTS total_modal_expenses NUMERIC,
  ADD COLUMN IF NOT EXISTS other_reconciling_item_expenses_incurred_by_the_buyer NUMERIC,
  ADD COLUMN IF NOT EXISTS contractee_agency_id UUID;